<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NoteScribe ‚Äî Audio to Sheet Music</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;0,700;1,300;1,400;1,600&family=Syne:wght@400;500;600;700;800&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --prussian: #001427;
    --teal: #708d81;
    --jasmine: #f4d58d;
    --brick: #bf0603;
    --blood: #8d0801;
    --paper: #f7f3ec;
    --ink: #001427;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  html { scroll-behavior: smooth; }

  body {
    background: var(--prussian);
    color: var(--paper);
    font-family: 'Syne', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* ‚îÄ‚îÄ PAGE SYSTEM ‚îÄ‚îÄ */
  .page { display: none; min-height: 100vh; }
  .page.active { display: block; }

  /* ‚îÄ‚îÄ SHARED NAV ‚îÄ‚îÄ */
  nav {
    position: fixed;
    top: 0; left: 0; right: 0;
    z-index: 100;
    padding: 20px 48px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: rgba(0,20,39,0.85);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid rgba(112,141,129,0.2);
  }

  .nav-logo {
    font-family: 'Cormorant Garamond', serif;
    font-size: 26px;
    font-weight: 700;
    letter-spacing: 1px;
    cursor: pointer;
    color: var(--jasmine);
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .nav-logo-glyph { font-size: 32px; color: var(--brick); line-height: 1; }

  .nav-links { display: flex; gap: 32px; align-items: center; }
  .nav-link {
    font-size: 12px;
    letter-spacing: 2.5px;
    text-transform: uppercase;
    color: var(--teal);
    cursor: pointer;
    transition: color 0.2s;
    background: none;
    border: none;
    font-family: 'Syne', sans-serif;
    font-weight: 600;
  }
  .nav-link:hover, .nav-link.active { color: var(--jasmine); }

  /* ‚îÄ‚îÄ HOME PAGE ‚îÄ‚îÄ */
  #page-home {
    background: var(--prussian);
    position: relative;
    overflow: hidden;
  }

  /* Background score lines */
  #page-home::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      repeating-linear-gradient(
        to bottom,
        transparent 0px, transparent 42px,
        rgba(112,141,129,0.12) 42px, rgba(112,141,129,0.12) 43px,
        transparent 43px, transparent 52px,
        rgba(112,141,129,0.12) 52px, rgba(112,141,129,0.12) 53px,
        transparent 53px, transparent 62px,
        rgba(112,141,129,0.12) 62px, rgba(112,141,129,0.12) 63px,
        transparent 63px, transparent 72px,
        rgba(112,141,129,0.12) 72px, rgba(112,141,129,0.12) 73px,
        transparent 73px, transparent 82px,
        rgba(112,141,129,0.12) 82px, rgba(112,141,129,0.12) 83px,
        transparent 83px, transparent 160px
      );
    pointer-events: none;
    z-index: 0;
  }

  /* Ambient glow */
  #page-home::after {
    content: '';
    position: fixed;
    top: -200px;
    left: -200px;
    width: 700px;
    height: 700px;
    background: radial-gradient(circle, rgba(191,6,3,0.12) 0%, transparent 65%);
    pointer-events: none;
    z-index: 0;
  }

  .home-inner {
    position: relative;
    z-index: 1;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 120px 32px 80px;
    text-align: center;
  }

  .home-eyebrow {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    letter-spacing: 4px;
    text-transform: uppercase;
    color: var(--teal);
    margin-bottom: 32px;
    opacity: 0;
    animation: fadeUp 0.8s ease 0.2s forwards;
  }

  .home-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: clamp(64px, 10vw, 120px);
    font-weight: 300;
    line-height: 0.95;
    letter-spacing: -2px;
    margin-bottom: 12px;
    opacity: 0;
    animation: fadeUp 0.8s ease 0.4s forwards;
  }

  .home-title .word-note { color: var(--jasmine); font-style: italic; }
  .home-title .word-scribe { color: var(--paper); }

  .home-divider {
    width: 1px;
    height: 60px;
    background: linear-gradient(to bottom, transparent, var(--teal), transparent);
    margin: 32px auto;
    opacity: 0;
    animation: fadeUp 0.6s ease 0.6s forwards;
  }

  .home-description {
    font-family: 'Cormorant Garamond', serif;
    font-size: clamp(18px, 2.5vw, 26px);
    font-weight: 300;
    font-style: italic;
    color: rgba(247,243,236,0.75);
    max-width: 620px;
    line-height: 1.6;
    margin-bottom: 16px;
    opacity: 0;
    animation: fadeUp 0.8s ease 0.7s forwards;
  }

  .home-subdesc {
    font-family: 'Syne', sans-serif;
    font-size: 13px;
    font-weight: 400;
    color: var(--teal);
    max-width: 480px;
    line-height: 1.7;
    letter-spacing: 0.3px;
    margin-bottom: 64px;
    opacity: 0;
    animation: fadeUp 0.8s ease 0.85s forwards;
  }

  .home-cta-group {
    display: flex;
    gap: 20px;
    align-items: center;
    flex-wrap: wrap;
    justify-content: center;
    opacity: 0;
    animation: fadeUp 0.8s ease 1s forwards;
  }

  .btn-primary {
    font-family: 'Syne', sans-serif;
    font-size: 13px;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    padding: 18px 48px;
    background: var(--brick);
    color: var(--paper);
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  .btn-primary:hover { background: var(--blood); box-shadow: 0 8px 32px rgba(191,6,3,0.4); }
  .btn-primary span { position: relative; z-index: 1; }

  .btn-secondary {
    font-family: 'Syne', sans-serif;
    font-size: 13px;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    padding: 17px 48px;
    background: transparent;
    color: var(--jasmine);
    border: 1px solid rgba(244,213,141,0.4);
    cursor: pointer;
    transition: all 0.2s ease;
  }
  .btn-secondary:hover {
    background: rgba(244,213,141,0.08);
    border-color: var(--jasmine);
  }

  /* Score decoration */
  .score-deco {
    position: fixed;
    bottom: 40px;
    right: -20px;
    font-family: 'Cormorant Garamond', serif;
    font-size: 200px;
    color: rgba(244,213,141,0.04);
    pointer-events: none;
    z-index: 0;
    line-height: 1;
    user-select: none;
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(24px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  /* ‚îÄ‚îÄ TRANSCRIBE PAGE ‚îÄ‚îÄ */
  #page-transcribe {
    background: var(--prussian);
    min-height: 100vh;
    padding-top: 80px;
    position: relative;
  }

  #page-transcribe::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      repeating-linear-gradient(
        to bottom,
        transparent 0px, transparent 42px,
        rgba(112,141,129,0.07) 42px, rgba(112,141,129,0.07) 43px,
        transparent 43px, transparent 52px,
        rgba(112,141,129,0.07) 52px, rgba(112,141,129,0.07) 53px,
        transparent 53px, transparent 62px,
        rgba(112,141,129,0.07) 62px, rgba(112,141,129,0.07) 63px,
        transparent 63px, transparent 72px,
        rgba(112,141,129,0.07) 72px, rgba(112,141,129,0.07) 73px,
        transparent 73px, transparent 82px,
        rgba(112,141,129,0.07) 82px, rgba(112,141,129,0.07) 83px,
        transparent 83px, transparent 160px
      );
    pointer-events: none;
    z-index: 0;
  }

  .page-inner {
    position: relative;
    z-index: 1;
    max-width: 900px;
    margin: 0 auto;
    padding: 56px 32px 80px;
  }

  .page-heading {
    font-family: 'Cormorant Garamond', serif;
    font-size: clamp(36px, 5vw, 56px);
    font-weight: 300;
    letter-spacing: -1px;
    color: var(--jasmine);
    margin-bottom: 8px;
  }
  .page-heading em { font-style: italic; color: var(--paper); }

  .page-subheading {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--teal);
    margin-bottom: 48px;
    display: flex;
    align-items: center;
    gap: 14px;
  }
  .page-subheading::after { content: ''; flex: 1; height: 1px; background: rgba(112,141,129,0.25); max-width: 300px; }

  /* Upload zone */
  .upload-zone {
    border: 1px solid rgba(112,141,129,0.35);
    background: rgba(112,141,129,0.04);
    padding: 64px 32px;
    text-align: center;
    cursor: pointer;
    transition: all 0.25s ease;
    position: relative;
    margin-bottom: 16px;
  }
  .upload-zone::before {
    content: '';
    position: absolute;
    top: 8px; left: 8px; right: 8px; bottom: 8px;
    border: 1px solid rgba(112,141,129,0.15);
    pointer-events: none;
    transition: border-color 0.25s;
  }
  .upload-zone:hover, .upload-zone.drag-over {
    border-color: var(--jasmine);
    background: rgba(244,213,141,0.04);
    box-shadow: inset 0 0 60px rgba(244,213,141,0.03);
  }
  .upload-zone:hover::before, .upload-zone.drag-over::before { border-color: rgba(244,213,141,0.25); }

  .upload-glyph {
    font-family: 'Cormorant Garamond', serif;
    font-size: 72px;
    color: rgba(244,213,141,0.3);
    line-height: 1;
    margin-bottom: 20px;
    display: block;
    transition: color 0.25s;
  }
  .upload-zone:hover .upload-glyph { color: rgba(244,213,141,0.6); }

  .upload-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 26px;
    font-weight: 600;
    color: var(--paper);
    margin-bottom: 8px;
  }
  .upload-sub {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    letter-spacing: 2px;
    color: var(--teal);
    margin-bottom: 20px;
  }
  .upload-formats { display: flex; justify-content: center; gap: 6px; flex-wrap: wrap; }
  .format-badge {
    font-family: 'JetBrains Mono', monospace;
    font-size: 9px;
    letter-spacing: 2px;
    text-transform: uppercase;
    padding: 4px 10px;
    border: 1px solid rgba(112,141,129,0.35);
    color: var(--teal);
    background: rgba(112,141,129,0.06);
  }
  #file-input { display: none; }

  .file-preview {
    display: none;
    background: rgba(112,141,129,0.08);
    border: 1px solid rgba(112,141,129,0.3);
    padding: 18px 22px;
    margin-bottom: 28px;
    align-items: center;
    gap: 16px;
  }
  .file-preview.show { display: flex; }
  .file-icon-box {
    width: 40px; height: 48px;
    border: 1px solid rgba(112,141,129,0.4);
    background: rgba(112,141,129,0.1);
    display: flex; align-items: center; justify-content: center;
    font-size: 18px; flex-shrink: 0;
  }
  .file-info { flex: 1; }
  .file-name { font-size: 13px; font-weight: 600; color: var(--paper); margin-bottom: 3px; }
  .file-size { font-family: 'JetBrains Mono', monospace; font-size: 10px; color: var(--teal); }
  .remove-file {
    background: none;
    border: 1px solid rgba(191,6,3,0.4);
    width: 28px; height: 28px;
    cursor: pointer; font-size: 12px;
    display: flex; align-items: center; justify-content: center;
    color: var(--brick); transition: all 0.15s;
  }
  .remove-file:hover { background: var(--brick); color: white; border-color: var(--brick); }

  /* Options */
  .options-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 32px;
  }
  @media(max-width:600px) { .options-row { grid-template-columns: 1fr; } }

  .option-card {
    background: rgba(112,141,129,0.06);
    border: 1px solid rgba(112,141,129,0.2);
    padding: 22px;
  }
  .option-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 9px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--teal);
    margin-bottom: 14px;
  }
  .radio-group { display: flex; flex-direction: column; gap: 8px; }
  .radio-option {
    display: flex; align-items: center; gap: 12px;
    cursor: pointer; padding: 9px 12px;
    border: 1px solid transparent;
    transition: all 0.15s;
  }
  .radio-option:hover { border-color: rgba(112,141,129,0.3); background: rgba(112,141,129,0.06); }
  .radio-option.selected { border-color: rgba(244,213,141,0.4); background: rgba(244,213,141,0.04); }
  .radio-dot {
    width: 12px; height: 12px;
    border: 1px solid var(--teal);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0; transition: border-color 0.15s;
  }
  .radio-option.selected .radio-dot { border-color: var(--jasmine); }
  .radio-dot::after {
    content: '';
    width: 5px; height: 5px;
    background: var(--jasmine);
    border-radius: 50%;
    opacity: 0; transition: opacity 0.15s;
  }
  .radio-option.selected .radio-dot::after { opacity: 1; }
  .radio-label { font-size: 12px; font-weight: 600; color: var(--paper); }
  .radio-sub { font-family: 'JetBrains Mono', monospace; font-size: 9px; color: rgba(112,141,129,0.8); margin-top: 2px; letter-spacing: 0.5px; }

  .styled-select {
    width: 100%;
    padding: 10px 14px;
    border: 1px solid rgba(112,141,129,0.3);
    background: rgba(0,20,39,0.5);
    color: var(--paper);
    font-family: 'Syne', sans-serif;
    font-size: 12px;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%23708d81'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 14px center;
    cursor: pointer;
    margin-bottom: 16px;
  }
  .styled-select:focus { outline: none; border-color: var(--jasmine); }

  /* Advanced */
  .advanced-toggle {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--teal);
    cursor: pointer;
    border: none;
    background: none;
    margin-bottom: 12px;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: color 0.2s;
  }
  .advanced-toggle:hover { color: var(--jasmine); }

  .advanced-panel {
    display: none;
    background: rgba(112,141,129,0.04);
    border: 1px solid rgba(112,141,129,0.2);
    padding: 22px;
    margin-bottom: 28px;
  }
  .advanced-panel.open { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
  .slider-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 9px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--teal);
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
  }
  .slider-val { color: var(--jasmine); }
  input[type=range] { width: 100%; accent-color: var(--jasmine); cursor: pointer; }
  .slider-hint { font-family: 'JetBrains Mono', monospace; font-size: 9px; color: rgba(112,141,129,0.6); margin-top: 6px; }

  /* Transcribe button */
  .transcribe-wrap { text-align: center; margin-bottom: 56px; }

  .btn-transcribe {
    font-family: 'Syne', sans-serif;
    font-size: 14px;
    font-weight: 700;
    letter-spacing: 3px;
    text-transform: uppercase;
    padding: 20px 64px;
    background: var(--brick);
    color: var(--paper);
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  .btn-transcribe:hover { background: var(--blood); box-shadow: 0 8px 32px rgba(191,6,3,0.4); }
  .btn-transcribe:active { box-shadow: none; }
  .btn-transcribe:disabled { opacity: 0.3; cursor: not-allowed; box-shadow: none; }

  /* Backend status */
  .backend-status {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    letter-spacing: 1.5px;
    color: var(--teal);
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 36px;
  }
  .status-dot { width: 7px; height: 7px; border-radius: 50%; background: rgba(112,141,129,0.4); }
  .status-dot.online { background: #4caf7d; box-shadow: 0 0 8px rgba(76,175,125,0.5); }
  .status-dot.offline { background: var(--brick); box-shadow: 0 0 8px rgba(191,6,3,0.4); }

  /* Error */
  .error-box {
    background: rgba(191,6,3,0.08);
    border: 1px solid rgba(191,6,3,0.4);
    padding: 18px 22px;
    margin-bottom: 24px;
    display: none;
  }
  .error-box.show { display: block; }
  .error-title {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--brick);
    margin-bottom: 8px;
  }
  .error-msg { font-size: 12px; color: rgba(247,243,236,0.7); line-height: 1.6; }

  /* Processing */
  .processing-section { display: none; margin-bottom: 48px; }
  .processing-section.show { display: block; }

  .waveform-display {
    height: 56px;
    background: rgba(112,141,129,0.04);
    border: 1px solid rgba(112,141,129,0.2);
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    padding: 8px 16px;
    gap: 2px;
    overflow: hidden;
  }
  .wave-bar {
    flex: 1;
    background: linear-gradient(to top, var(--brick), var(--jasmine));
    border-radius: 1px;
    min-height: 2px;
    animation: waveAnim 1.5s ease-in-out infinite alternate;
    opacity: 0.7;
  }
  @keyframes waveAnim { from { transform: scaleY(1); } to { transform: scaleY(0.15); } }

  .pipeline {
    display: grid;
    grid-template-columns: repeat(4,1fr);
    border: 1px solid rgba(112,141,129,0.2);
    overflow: hidden;
    margin-bottom: 16px;
  }
  @media(max-width:600px) { .pipeline { grid-template-columns: 1fr 1fr; } }

  .pipeline-step {
    padding: 18px 14px;
    border-right: 1px solid rgba(112,141,129,0.2);
    text-align: center;
    background: rgba(112,141,129,0.03);
    transition: background 0.4s;
  }
  .pipeline-step:last-child { border-right: none; }
  .pipeline-step.active { background: rgba(244,213,141,0.06); }
  .pipeline-step.done { background: rgba(112,141,129,0.15); }
  .step-num {
    font-family: 'JetBrains Mono', monospace;
    font-size: 8px;
    letter-spacing: 2px;
    color: rgba(112,141,129,0.5);
    margin-bottom: 6px;
  }
  .step-icon { font-size: 20px; margin-bottom: 6px; display: block; }
  .step-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 9px;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--teal);
    font-weight: 500;
  }
  .pipeline-step.done .step-label { color: var(--jasmine); }

  .progress-bar-wrap {
    height: 2px;
    background: rgba(112,141,129,0.15);
    overflow: hidden;
    margin-bottom: 12px;
  }
  .progress-bar {
    height: 100%;
    background: linear-gradient(to right, var(--brick), var(--jasmine));
    width: 0%;
    transition: width 0.5s ease;
  }
  .processing-message {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    letter-spacing: 2px;
    text-align: center;
    color: var(--teal);
    min-height: 18px;
  }

  /* Results */
  .results-section { display: none; margin-bottom: 64px; }
  .results-section.show { display: block; }

  .results-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 9px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--teal);
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 14px;
  }
  .results-label::after { content: ''; flex: 1; height: 1px; background: rgba(112,141,129,0.2); }

  .stats-row {
    display: grid;
    grid-template-columns: repeat(4,1fr);
    gap: 12px;
    margin-bottom: 24px;
  }
  @media(max-width:600px) { .stats-row { grid-template-columns: 1fr 1fr; } }

  .stat-card {
    background: rgba(112,141,129,0.06);
    border: 1px solid rgba(112,141,129,0.2);
    padding: 18px 14px;
    text-align: center;
  }
  .stat-val {
    font-family: 'Cormorant Garamond', serif;
    font-size: 32px;
    font-weight: 700;
    color: var(--jasmine);
    line-height: 1;
    margin-bottom: 6px;
  }
  .stat-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 8px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--teal);
  }

  .notes-display {
    background: rgba(112,141,129,0.04);
    border: 1px solid rgba(112,141,129,0.2);
    padding: 22px;
    margin-bottom: 20px;
  }
  .notes-title {
    font-family: 'JetBrains Mono', monospace;
    font-size: 9px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--teal);
    margin-bottom: 14px;
  }
  .notes-scroll { display: flex; gap: 6px; flex-wrap: wrap; }
  .note-chip {
    font-family: 'Cormorant Garamond', serif;
    font-size: 13px;
    font-weight: 700;
    padding: 4px 12px;
    border: 1px solid rgba(244,213,141,0.3);
    color: var(--jasmine);
    background: rgba(244,213,141,0.05);
    opacity: 0;
    transform: translateY(8px);
    animation: noteAppear 0.3s ease forwards;
  }
  @keyframes noteAppear { to { opacity: 1; transform: translateY(0); } }

  .sheet-music-display {
    background: #f7f4ee;
    border: 1px solid rgba(112,141,129,0.3);
    padding: 32px;
    margin-bottom: 24px;
    overflow-x: auto;
  }
  .sheet-header { text-align: center; margin-bottom: 24px; border-bottom: 1px solid #ddd; padding-bottom: 18px; }
  .sheet-title { font-family: 'Cormorant Garamond', serif; font-size: 22px; font-weight: 700; color: #001427; margin-bottom: 4px; }
  .sheet-subtitle { font-family: 'Syne', sans-serif; font-style: italic; font-size: 11px; color: #888; letter-spacing: 1px; }
  .sheet-meta { display: flex; justify-content: space-between; font-family: 'JetBrains Mono', monospace; font-size: 10px; color: #aaa; margin-top: 8px; letter-spacing: 1px; }

  .result-actions { display: flex; gap: 12px; flex-wrap: wrap; }
  .btn-action {
    font-family: 'Syne', sans-serif;
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    padding: 12px 22px;
    border: 1px solid rgba(112,141,129,0.35);
    background: transparent;
    color: var(--teal);
    cursor: pointer;
    transition: all 0.15s;
    text-decoration: none;
    display: flex; align-items: center; gap: 8px;
  }
  .btn-action:hover { border-color: var(--jasmine); color: var(--jasmine); background: rgba(244,213,141,0.04); }
  .btn-action.primary { background: rgba(191,6,3,0.15); border-color: rgba(191,6,3,0.5); color: #ff8a87; }
  .btn-action.primary:hover { background: var(--brick); color: white; border-color: var(--brick); }

  /* Toast */
  .toast {
    position: fixed;
    bottom: 28px;
    right: 28px;
    background: rgba(0,20,39,0.95);
    color: var(--paper);
    padding: 12px 20px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    letter-spacing: 1px;
    z-index: 999;
    transform: translateY(80px);
    opacity: 0;
    transition: all 0.3s ease;
    border-left: 3px solid var(--jasmine);
    backdrop-filter: blur(8px);
  }
  .toast.show { transform: translateY(0); opacity: 1; }

  /* ‚îÄ‚îÄ EXAMPLES PAGE ‚îÄ‚îÄ */
  #page-examples {
    background: var(--prussian);
    min-height: 100vh;
    padding-top: 80px;
  }

  .examples-inner {
    position: relative;
    z-index: 1;
    max-width: 900px;
    margin: 0 auto;
    padding: 56px 32px 80px;
  }

  .examples-coming-soon {
    margin-top: 48px;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
  }
  @media(max-width:700px) { .examples-coming-soon { grid-template-columns: 1fr; } }

  .example-placeholder {
    border: 1px solid rgba(112,141,129,0.2);
    background: rgba(112,141,129,0.04);
    padding: 36px 24px;
    text-align: center;
    position: relative;
    overflow: hidden;
  }
  .example-placeholder::before {
    content: 'ùÑû';
    position: absolute;
    bottom: -16px;
    right: -8px;
    font-family: 'Cormorant Garamond', serif;
    font-size: 96px;
    color: rgba(112,141,129,0.07);
    pointer-events: none;
    line-height: 1;
  }

  .placeholder-type {
    font-family: 'JetBrains Mono', monospace;
    font-size: 8px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--teal);
    margin-bottom: 14px;
    display: inline-block;
    border: 1px solid rgba(112,141,129,0.25);
    padding: 4px 10px;
  }

  .placeholder-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 22px;
    font-weight: 600;
    font-style: italic;
    color: rgba(247,243,236,0.5);
    margin-bottom: 8px;
  }

  .placeholder-desc {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    letter-spacing: 1px;
    color: rgba(112,141,129,0.5);
    line-height: 1.6;
  }

  .placeholder-mini-staff {
    height: 40px;
    border: 1px solid rgba(112,141,129,0.15);
    margin: 16px 0;
    position: relative;
    overflow: hidden;
  }
  .placeholder-mini-staff::before {
    content: '';
    position: absolute;
    left: 0; right: 0;
    top: 25%; bottom: 75%;
    background: rgba(112,141,129,0.15);
  }
</style>
</head>
<body>

<!-- ‚îÄ‚îÄ NAV ‚îÄ‚îÄ -->
<nav>
  <a class="nav-logo" onclick="showPage('home')">
    <span class="nav-logo-glyph">ùÑû</span>
    NoteScribe
  </a>
  <div class="nav-links">
    <button class="nav-link" onclick="showPage('home')" id="nav-home">Home</button>
    <button class="nav-link" onclick="showPage('transcribe')" id="nav-transcribe">Transcribe</button>
    <button class="nav-link" onclick="showPage('examples')" id="nav-examples">Examples</button>
  </div>
</nav>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     HOME PAGE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page active" id="page-home">
  <div class="home-inner">
    <div class="home-eyebrow">Audio ¬∑ Pitch Detection ¬∑ Sheet Music</div>

    <h1 class="home-title">
      <span class="word-note">Note</span><span class="word-scribe">Scribe</span>
    </h1>

    <div class="home-divider"></div>

    <p class="home-description">
      Transform any melody into beautifully engraved sheet music ‚Äî instantly.
    </p>

    <p class="home-subdesc">
      Upload an audio file and NoteScribe uses Spotify's Basic Pitch neural model
      to detect every note, build a MIDI representation, and render publication-ready
      sheet music in MusicXML, MIDI, or PDF.
    </p>

    <div class="home-cta-group">
      <button class="btn-primary" onclick="showPage('transcribe')">
        <span>Try It Out</span>
      </button>
      <button class="btn-secondary" onclick="showPage('examples')">
        Check Out Examples
      </button>
    </div>

  </div>

  <div class="score-deco">ùÑ¢</div>
</div>


<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TRANSCRIBE PAGE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-transcribe">
  <div class="page-inner">

    <div class="page-subheading">01 ‚Äî Upload &amp; Configure</div>
    <h2 class="page-heading">Transcribe <em>your audio</em></h2>

    <!-- Backend status -->
    <div class="backend-status">
      <div class="status-dot" id="status-dot"></div>
      <span id="status-label">Checking backend‚Ä¶</span>
    </div>

    <!-- Upload zone -->
    <div class="upload-zone" id="upload-zone">
      <span class="upload-glyph">‚ô©</span>
      <div class="upload-title">Drop your audio file here</div>
      <p class="upload-sub">or click to browse</p>
      <div class="upload-formats">
        <span class="format-badge">MP3</span>
        <span class="format-badge">WAV</span>
        <span class="format-badge">M4A</span>
        <span class="format-badge">OGG</span>
        <span class="format-badge">FLAC</span>
      </div>
    </div>
    <input type="file" id="file-input" accept=".mp3,.wav,.m4a,.ogg,.flac,audio/*">

    <div class="file-preview" id="file-preview">
      <div class="file-icon-box">‚ô™</div>
      <div class="file-info">
        <div class="file-name" id="file-name">filename.mp3</div>
        <div class="file-size" id="file-size">0 KB</div>
      </div>
      <button class="remove-file" id="remove-file" title="Remove">‚úï</button>
    </div>

    <!-- Options -->
    <div class="options-row">
      <div class="option-card">
        <div class="option-label">Output Format</div>
        <div class="radio-group" id="output-format">
          <label class="radio-option selected" data-val="musicxml">
            <span class="radio-dot"></span>
            <div>
              <div class="radio-label">MusicXML</div>
              <div class="radio-sub">MuseScore ¬∑ Finale ¬∑ Sibelius</div>
            </div>
          </label>
          <label class="radio-option" data-val="midi">
            <span class="radio-dot"></span>
            <div>
              <div class="radio-label">MIDI</div>
              <div class="radio-sub">DAWs and digital playback</div>
            </div>
          </label>
          <label class="radio-option" data-val="pdf">
            <span class="radio-dot"></span>
            <div>
              <div class="radio-label">PDF</div>
              <div class="radio-sub">Print-ready (requires MuseScore)</div>
            </div>
          </label>
        </div>
      </div>

      <div class="option-card">
        <div class="option-label">Key Signature</div>
        <select class="styled-select" id="key-sig">
          <option value="auto">Auto-detect</option>
          <option value="C">C Major / A Minor</option>
          <option value="G">G Major / E Minor</option>
          <option value="D">D Major / B Minor</option>
          <option value="A">A Major / F# Minor</option>
          <option value="F">F Major / D Minor</option>
          <option value="Bb">B‚ô≠ Major / G Minor</option>
          <option value="Eb">E‚ô≠ Major / C Minor</option>
        </select>
        <div class="option-label">Time Signature</div>
        <select class="styled-select" id="time-sig">
          <option value="auto">Auto-detect</option>
          <option value="4/4">4/4 ‚Äî Common Time</option>
          <option value="3/4">3/4 ‚Äî Waltz</option>
          <option value="6/8">6/8 ‚Äî Compound</option>
          <option value="2/4">2/4 ‚Äî March</option>
          <option value="5/4">5/4 ‚Äî Odd Meter</option>
        </select>
      </div>
    </div>


    <!-- Transcribe button -->
    <div class="transcribe-wrap">
      <button class="btn-transcribe" id="btn-transcribe" disabled>
        ùÑû &nbsp;&nbsp; Transcribe to Sheet Music
      </button>
    </div>

    <!-- Error -->
    <div class="error-box" id="error-box">
      <div class="error-title">‚ö† Transcription Error</div>
      <div class="error-msg" id="error-msg"></div>
    </div>

    <!-- Processing -->
    <section class="processing-section" id="processing-section">
      <div class="waveform-display" id="waveform"></div>
      <div class="pipeline">
        <div class="pipeline-step" id="step-1">
          <div class="step-num">01</div>
          <span class="step-icon">üìÇ</span>
          <div class="step-label">Upload</div>
        </div>
        <div class="pipeline-step" id="step-2">
          <div class="step-num">02</div>
          <span class="step-icon">üéµ</span>
          <div class="step-label">Basic Pitch</div>
        </div>
        <div class="pipeline-step" id="step-3">
          <div class="step-num">03</div>
          <span class="step-icon">üéπ</span>
          <div class="step-label">MIDI</div>
        </div>
        <div class="pipeline-step" id="step-4">
          <div class="step-num">04</div>
          <span class="step-icon">üìÑ</span>
          <div class="step-label">Sheet Music</div>
        </div>
      </div>
      <div class="progress-bar-wrap"><div class="progress-bar" id="progress-bar"></div></div>
      <div class="processing-message" id="processing-msg">Uploading audio file‚Ä¶</div>
    </section>

    <!-- Results -->
    <section class="results-section" id="results-section">
      <div class="results-label">Transcription Results</div>
      <div class="stats-row" id="stats-row"></div>

      <div class="notes-display">
        <div class="notes-title">Detected Notes</div>
        <div class="notes-scroll" id="notes-display"></div>
      </div>

      <div class="sheet-music-display">
        <div class="sheet-header">
          <div class="sheet-title" id="result-title">Transcription</div>
          <div class="sheet-subtitle">Generated by NoteScribe ¬∑ Basic Pitch (Spotify) ‚Üí music21</div>
          <div class="sheet-meta">
            <span id="result-key">Key: C Major</span>
            <span id="result-time">Time: 4/4</span>
            <span id="result-tempo">‚ô© = 120 BPM</span>
          </div>
        </div>
        <div id="staff-svg-wrap"></div>
      </div>

      <div class="result-actions" id="result-actions"></div>
    </section>

  </div>
</div>


<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     EXAMPLES PAGE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-examples">
  <div class="examples-inner">

    <div class="page-subheading">Browse ¬∑ Listen ¬∑ Study</div>
    <h2 class="page-heading">Example <em>Transcriptions</em></h2>

    <div class="examples-coming-soon">
      <!-- fill withwith real examples later -->
      <div class="example-placeholder">
        <span class="placeholder-title">Example 01</span>
        <div class="placeholder-mini-staff"></div>
        <div class="placeholder-desc">Coming soon</div>
      </div>
      <div class="example-placeholder">
        <span class="placeholder-title">Example 02</span>
        <div class="placeholder-mini-staff"></div>
        <div class="placeholder-desc">Coming soon</div>
      </div>
      <div class="example-placeholder">
        <span class="placeholder-title">Example 03</span>
        <div class="placeholder-mini-staff"></div>
        <div class="placeholder-desc">Coming soon</div>
      </div>
      <div class="example-placeholder">
        <span class="placeholder-title">Example 04</span>
        <div class="placeholder-mini-staff"></div>
        <div class="placeholder-desc">Coming soon</div>
      </div>
      <div class="example-placeholder">
        <span class="placeholder-title">Example 05</span>
        <div class="placeholder-mini-staff"></div>
        <div class="placeholder-desc">Coming soon</div>
      </div>
      <div class="example-placeholder">
        <span class="placeholder-title">Example 06</span>
        <div class="placeholder-mini-staff"></div>
        <div class="placeholder-desc">Coming soon</div>
      </div>
    </div>

  </div>
</div>


<!-- ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ -->
<div class="toast" id="toast"></div>


<script>
  const API_BASE = 'http://localhost:5000';
  let selectedFile = null;
  let currentJobId = null;
  let outputFormat = 'musicxml';

  // ‚îÄ‚îÄ Page routing ‚îÄ‚îÄ
  function showPage(name) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
    document.getElementById('page-' + name).classList.add('active');
    document.getElementById('nav-' + name).classList.add('active');
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }
  // Set initial active nav
  document.getElementById('nav-home').classList.add('active');

  // ‚îÄ‚îÄ Backend health check ‚îÄ‚îÄ
  async function checkBackend() {
    try {
      const r = await fetch(`${API_BASE}/health`, { signal: AbortSignal.timeout(3000) });
      const ok = r.ok;
      document.getElementById('status-dot').className = 'status-dot ' + (ok ? 'online' : 'offline');
      document.getElementById('status-label').textContent = ok ? 'Backend online' : 'Backend error';
    } catch {
      document.getElementById('status-dot').className = 'status-dot offline';
      document.getElementById('status-label').textContent = 'Backend offline ‚Äî start server first';
    }
  }
  checkBackend();
  setInterval(checkBackend, 15000);

  // ‚îÄ‚îÄ File upload ‚îÄ‚îÄ
  const uploadZone = document.getElementById('upload-zone');
  const fileInput  = document.getElementById('file-input');
  uploadZone.addEventListener('click', () => fileInput.click());
  fileInput.addEventListener('change', e => handleFile(e.target.files[0]));
  uploadZone.addEventListener('dragover', e => { e.preventDefault(); uploadZone.classList.add('drag-over'); });
  uploadZone.addEventListener('dragleave', () => uploadZone.classList.remove('drag-over'));
  uploadZone.addEventListener('drop', e => {
    e.preventDefault(); uploadZone.classList.remove('drag-over');
    if (e.dataTransfer.files[0]) handleFile(e.dataTransfer.files[0]);
  });

  function handleFile(file) {
    if (!file) return;
    selectedFile = file;
    document.getElementById('file-name').textContent = file.name;
    document.getElementById('file-size').textContent = formatBytes(file.size);
    document.getElementById('file-preview').classList.add('show');
    document.getElementById('btn-transcribe').disabled = false;
    showToast('File loaded: ' + file.name);
  }

  document.getElementById('remove-file').addEventListener('click', () => {
    selectedFile = null; fileInput.value = '';
    document.getElementById('file-preview').classList.remove('show');
    document.getElementById('btn-transcribe').disabled = true;
  });

  function formatBytes(b) {
    if (b < 1024) return b + ' B';
    if (b < 1048576) return (b/1024).toFixed(1) + ' KB';
    return (b/1048576).toFixed(2) + ' MB';
  }

  // ‚îÄ‚îÄ Radio options ‚îÄ‚îÄ
  document.querySelectorAll('#output-format .radio-option').forEach(opt => {
    opt.addEventListener('click', () => {
      document.querySelectorAll('#output-format .radio-option').forEach(o => o.classList.remove('selected'));
      opt.classList.add('selected');
      outputFormat = opt.dataset.val;
    });
  });

  // ‚îÄ‚îÄ Advanced panel ‚îÄ‚îÄ
  document.getElementById('advanced-toggle').addEventListener('click', () => {
    document.getElementById('advanced-panel').classList.toggle('open');
  });
  document.getElementById('onset-thresh').addEventListener('input', e => {
    document.getElementById('onset-val').textContent = parseFloat(e.target.value).toFixed(2);
  });
  document.getElementById('frame-thresh').addEventListener('input', e => {
    document.getElementById('frame-val').textContent = parseFloat(e.target.value).toFixed(2);
  });

  // ‚îÄ‚îÄ Waveform ‚îÄ‚îÄ
  function buildWaveform() {
    const wf = document.getElementById('waveform');
    wf.innerHTML = '';
    for (let i = 0; i < 80; i++) {
      const bar = document.createElement('div');
      bar.className = 'wave-bar';
      bar.style.height = (10 + Math.random() * 80) + '%';
      bar.style.animationDelay = (Math.random() * 1.5) + 's';
      bar.style.animationDuration = (0.8 + Math.random() * 1.2) + 's';
      wf.appendChild(bar);
    }
  }

  // ‚îÄ‚îÄ Steps ‚îÄ‚îÄ
  function setStep(idx) {
    const steps = ['step-1','step-2','step-3','step-4'];
    const msgs  = [
      'Uploading audio to server‚Ä¶',
      'Running Basic Pitch pitch detection model‚Ä¶',
      'Quantizing notes into MIDI‚Ä¶',
      'Engraving sheet music with music21‚Ä¶'
    ];
    const progresses = [20, 50, 75, 95];
    steps.forEach((id, i) => {
      const el = document.getElementById(id);
      el.classList.remove('active','done');
      if (i < idx) el.classList.add('done');
      else if (i === idx) el.classList.add('active');
    });
    document.getElementById('progress-bar').style.width = progresses[idx] + '%';
    document.getElementById('processing-msg').textContent = msgs[idx];
  }

  // ‚îÄ‚îÄ Main transcription ‚îÄ‚îÄ
  document.getElementById('btn-transcribe').addEventListener('click', runTranscription);

  async function runTranscription() {
    if (!selectedFile) return;
    const errorBox = document.getElementById('error-box');
    errorBox.classList.remove('show');
    document.getElementById('btn-transcribe').disabled = true;
    document.getElementById('processing-section').classList.add('show');
    document.getElementById('results-section').classList.remove('show');
    buildWaveform();
    setStep(0);

    const formData = new FormData();
    formData.append('file', selectedFile);
    formData.append('key_sig', document.getElementById('key-sig').value);
    formData.append('time_sig', document.getElementById('time-sig').value);
    formData.append('output_format', outputFormat);
    formData.append('onset_threshold', document.getElementById('onset-thresh').value);
    formData.append('frame_threshold', document.getElementById('frame-thresh').value);

    try {
      await delay(600); setStep(1);
      const response = await fetch(`${API_BASE}/transcribe`, { method: 'POST', body: formData });
      setStep(2); await delay(400); setStep(3);
      const data = await response.json();
      if (!response.ok) throw new Error(data.error || 'Server returned an error');
      await delay(600);
      document.getElementById('progress-bar').style.width = '100%';
      currentJobId = data.job_id;
      await showResults(data);
    } catch (err) {
      console.error(err);
      document.getElementById('error-msg').textContent = err.message + '\n\nMake sure the Python backend is running: python app.py';
      errorBox.classList.add('show');
      document.getElementById('processing-section').classList.remove('show');
      showToast('‚ö† Transcription failed');
    } finally {
      document.getElementById('btn-transcribe').disabled = false;
    }
  }

  async function showResults(data) {
    const meta = data.metadata;

    document.getElementById('stats-row').innerHTML = [
      { val: meta.note_count,        label: 'Notes Detected' },
      { val: meta.measure_count,     label: 'Measures' },
      { val: meta.tempo_bpm + ' BPM', label: 'Tempo' },
      { val: meta.key,               label: 'Key' },
    ].map(s => `<div class="stat-card"><div class="stat-val">${s.val}</div><div class="stat-label">${s.label}</div></div>`).join('');

    document.getElementById('notes-display').innerHTML = (meta.notes_sample || [])
      .map((n, i) => `<span class="note-chip" style="animation-delay:${i*0.03}s">${n}</span>`).join('');

    const fname = selectedFile.name.replace(/\.[^.]+$/, '');
    document.getElementById('result-title').textContent = fname;
    document.getElementById('result-key').textContent   = 'Key: ' + meta.key;
    document.getElementById('result-time').textContent  = 'Time: ' + meta.time_signature;
    document.getElementById('result-tempo').textContent = `‚ô© = ${meta.tempo_bpm} BPM`;

    renderStaff(meta.notes_sample || [], meta.time_signature);

    const actions = document.getElementById('result-actions');
    actions.innerHTML = '';
    for (const [fmt, url] of Object.entries(data.download_urls)) {
      const a = document.createElement('a');
      a.className = 'btn-action' + (fmt === 'musicxml' ? ' primary' : '');
      a.href = `${API_BASE}${url}`;
      a.download = '';
      a.innerHTML = `‚¨á Download ${fmt.toUpperCase()}`;
      actions.appendChild(a);
    }
    const newBtn = document.createElement('button');
    newBtn.className = 'btn-action';
    newBtn.innerHTML = '‚Ü∫ Transcribe Another';
    newBtn.addEventListener('click', resetUI);
    actions.appendChild(newBtn);

    document.getElementById('results-section').classList.add('show');
    document.getElementById('results-section').scrollIntoView({ behavior: 'smooth', block: 'start' });
    showToast('Transcription complete ‚úì');
  }

  function resetUI() {
    selectedFile = null; fileInput.value = '';
    document.getElementById('file-preview').classList.remove('show');
    document.getElementById('btn-transcribe').disabled = true;
    document.getElementById('processing-section').classList.remove('show');
    document.getElementById('results-section').classList.remove('show');
    document.getElementById('error-box').classList.remove('show');
    ['step-1','step-2','step-3','step-4'].forEach(id => document.getElementById(id).classList.remove('active','done'));
    document.getElementById('progress-bar').style.width = '0';
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  // ‚îÄ‚îÄ SVG staff renderer ‚îÄ‚îÄ
  function renderStaff(notes, timeSig) {
    const NOTE_Y = {
      'C3':74,'D3':70,'E3':66,'F3':62,'G3':58,'A3':54,'B3':50,
      'C4':46,'D4':42,'E4':38,'F4':34,'G4':30,'A4':26,'B4':22,
      'C5':18,'D5':14,'E5':10,'F5':6,'G5':2,
      'C#3':74,'D#3':70,'F#3':62,'G#3':58,'A#3':54,
      'C#4':46,'D#4':42,'F#4':34,'G#4':30,'A#4':26,
      'C#5':18,'D#5':14,'F#5':6,
    };
    const beatsPerMeasure = timeSig==='3/4'?3:timeSig==='6/8'?6:timeSig==='2/4'?2:4;
    const measPerRow=4, W=840, rowH=110, marginL=68;
    const staffTop=20, staffSpacing=10, lineCount=5;
    const rows = Math.max(1, Math.ceil(Math.ceil(notes.length/beatsPerMeasure)/measPerRow));
    const H = rows*rowH+40;
    const measWidth = (W-marginL-20)/measPerRow;
    let svg = `<svg width="${W}" height="${H}" viewBox="0 0 ${W} ${H}" style="max-width:100%">`;
    svg += `<rect width="${W}" height="${H}" fill="#f7f4ee"/>`;
    for (let row=0;row<rows;row++) {
      const ry=30+row*rowH;
      for (let l=0;l<lineCount;l++) {
        const y=ry+staffTop+l*staffSpacing;
        svg += `<line x1="${marginL-12}" y1="${y}" x2="${W-10}" y2="${y}" stroke="#555" stroke-width="1.2"/>`;
      }
      svg += `<text x="${marginL-56}" y="${ry+staffTop+36}" font-size="52" fill="#222" style="font-family:serif">ùÑû</text>`;
      const [beats] = timeSig==='auto'?[4,4]:(timeSig||'4/4').split('/').map(Number);
      const beatVal = timeSig==='6/8'?8:4;
      svg += `<text x="${marginL+2}" y="${ry+staffTop+16}" font-size="15" font-weight="bold" fill="#333">${beats}</text>`;
      svg += `<text x="${marginL+2}" y="${ry+staffTop+32}" font-size="15" font-weight="bold" fill="#333">${beatVal}</text>`;
      for (let m=0;m<measPerRow;m++) {
        const measIdx=row*measPerRow+m;
        if (measIdx>=Math.ceil(notes.length/beatsPerMeasure)) break;
        const mx=marginL+28+m*measWidth;
        svg += `<line x1="${mx}" y1="${ry+staffTop}" x2="${mx}" y2="${ry+staffTop+(lineCount-1)*staffSpacing}" stroke="#666" stroke-width="1.5"/>`;
        for (let n=0;n<beatsPerMeasure;n++) {
          const ni=measIdx*beatsPerMeasure+n;
          if (ni>=notes.length) break;
          const note=notes[ni];
          const nx=mx+14+n*(measWidth/beatsPerMeasure);
          let ny=ry+staffTop+(NOTE_Y[note]!==undefined?NOTE_Y[note]/10*staffSpacing:2*staffSpacing);
          if (note.startsWith('C4')||note==='C4') {
            const ledgerY=ry+staffTop+lineCount*staffSpacing+staffSpacing/2;
            svg += `<line x1="${nx-5}" y1="${ledgerY}" x2="${nx+13}" y2="${ledgerY}" stroke="#777" stroke-width="1"/>`;
            ny=ledgerY;
          }
          const isSharp=note.includes('#');
          if (isSharp) svg+=`<text x="${nx-9}" y="${ny+4}" font-size="11" fill="#444">‚ôØ</text>`;
          svg+=`<ellipse cx="${nx+5}" cy="${ny}" rx="6" ry="4.5" fill="#1a1a1a" transform="rotate(-18,${nx+5},${ny})"/>`;
          const stemDir=ny>(ry+staffTop+2.5*staffSpacing)?-1:1;
          const stemX=stemDir>0?nx-1:nx+11;
          svg+=`<line x1="${stemX}" y1="${ny}" x2="${stemX}" y2="${ny+stemDir*28}" stroke="#1a1a1a" stroke-width="1.5"/>`;
        }
      }
      const lastM=Math.min(measPerRow,Math.ceil(notes.length/beatsPerMeasure)-row*measPerRow);
      const fx=marginL+28+lastM*measWidth;
      svg+=`<line x1="${fx-4}" y1="${ry+staffTop}" x2="${fx-4}" y2="${ry+staffTop+(lineCount-1)*staffSpacing}" stroke="#555" stroke-width="1.2"/>`;
      svg+=`<line x1="${fx}" y1="${ry+staffTop}" x2="${fx}" y2="${ry+staffTop+(lineCount-1)*staffSpacing}" stroke="#555" stroke-width="2.5"/>`;
    }
    svg += '</svg>';
    document.getElementById('staff-svg-wrap').innerHTML = svg;
  }

  function delay(ms) { return new Promise(r => setTimeout(r, ms)); }

  let toastTimer;
  function showToast(msg) {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.classList.add('show');
    clearTimeout(toastTimer);
    toastTimer = setTimeout(() => t.classList.remove('show'), 3000);
  }
</script>
</body>
</html>